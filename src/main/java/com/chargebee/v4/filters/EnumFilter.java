/*
 * This file is auto-generated by Chargebee.
 * Copyright 2025 Chargebee Inc.
 */

package com.chargebee.v4.filters;

import java.util.Arrays;
import java.util.Map;
import java.util.function.Function;
import java.util.stream.Collectors;

/**
 * Filter for enum fields supporting is, isNot, in, notIn operations.
 *
 * @param <T> The enum type
 * @param <B> The builder type to return for method chaining
 */
public class EnumFilter<T, B> {

  protected final String fieldName;
  protected final B builder;
  protected final Map<String, Object> params;
  protected final Function<T, String> valueExtractor;
  private boolean supportsMultiOperators = true;
  private boolean supportsPresenceOperator = false;

  /**
   * Creates an EnumFilter with a custom value extractor.
   *
   * @param fieldName the field name for the filter
   * @param builder the builder instance for method chaining
   * @param params the params map to store filter values
   * @param valueExtractor function to extract string value from enum (e.g., Enum::getValue)
   */
  public EnumFilter(
      String fieldName, B builder, Map<String, Object> params, Function<T, String> valueExtractor) {
    this.fieldName = fieldName;
    this.builder = builder;
    this.params = params;
    this.valueExtractor = valueExtractor;
  }

  public EnumFilter<T, B> supportsMultiOperators(boolean supportsMultiOperators) {
    this.supportsMultiOperators = supportsMultiOperators;
    return this;
  }

  public EnumFilter<T, B> supportsPresenceOperator(boolean supportsPresenceOperator) {
    this.supportsPresenceOperator = supportsPresenceOperator;
    return this;
  }

  public B is(T value) {
    params.put(fieldName + "[is]", valueExtractor.apply(value));
    return builder;
  }

  public B isNot(T value) {
    params.put(fieldName + "[is_not]", valueExtractor.apply(value));
    return builder;
  }

  @SafeVarargs
  public final B in(T... values) {
    if (!supportsMultiOperators) {
      throw new UnsupportedOperationException(
          "operator '[in]' is not supported for this filter-parameter");
    }
    String formatted =
        "[" + Arrays.stream(values).map(valueExtractor).collect(Collectors.joining(",")) + "]";
    params.put(fieldName + "[in]", formatted);
    return builder;
  }

  @SafeVarargs
  public final B notIn(T... values) {
    if (!supportsMultiOperators) {
      throw new UnsupportedOperationException(
          "operator '[not_in]' is not supported for this filter-parameter");
    }
    String formatted =
        "[" + Arrays.stream(values).map(valueExtractor).collect(Collectors.joining(",")) + "]";
    params.put(fieldName + "[not_in]", formatted);
    return builder;
  }

  public B isPresent(boolean value) {
    if (!supportsPresenceOperator) {
      throw new UnsupportedOperationException(
          "operator '[is_present]' is not supported for this filter-parameter");
    }
    params.put(fieldName + "[is_present]", String.valueOf(value));
    return builder;
  }
}

